<div class="px-5 text-white flex flex-col gap-8 items-start justify-center w-full">
  <ng-container *ngIf="watchedMovies$ | async as watchedMovies ; else loadingOrError">
    <ng-container *ngIf="watchedMovies.length > 0; else noWatchedMovies">
      <p class="opacity-70 text-2xl inter-semibold">You have watched {{watchedMovies.length}} movies</p>
      <div class="flex gap-5 items-center justify-end border-t-2 border-b-2 py-3 w-full">
        <div class="justify-start self-end">
          <button
            *ngIf="filtersCheck()"
            class="flex gap-2 text-white bg-red-500 hover:bg-red-600 px-3 py-2 rounded-md transition-all duration-200"
            (click)="resetFilters()">
            <p class="inter-bold text-md">Reset Filters</p>
            <i-lucide [img]="LucideX"></i-lucide>
          </button>
        </div>
        <div class="relative">
          <div (click)="toggleDropDown('decade')" class="flex gap-1 transition-all duration-200 cursor-pointer opacity-80 hover:opacity-100">
            <p class="inter-semibold text-md">DECADE</p>
            <i-lucide [img]="LucideChevronDown"></i-lucide>
          </div>
          <div *ngIf="isDecadeDropDownOpen" class="absolute left-1/2 mt-2 dropdown-animate background-black text-white flex flex-col py-2 items-center justify-center w-25 rounded-md">
            <p (click)="selectDecade('2020')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">2020s</p>
            <p (click)="selectDecade('2010')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">2010s</p>
            <p (click)="selectDecade('2000')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">2000s</p>
            <p (click)="selectDecade('1990')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">1990s</p>
            <p (click)="selectDecade('1980')"  class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">1980s</p>
            <p (click)="selectDecade('1970')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">1970s</p>
            <p (click)="selectDecade('1960')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">1960s</p>
            <p (click)="selectDecade('1950')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">1950s</p>
            <p (click)="selectDecade('1940')" class="text-lg inter-semibold text-center cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">1940s</p>
          </div>
        </div>

        <div class="relative">
          <div (click)="toggleDropDown('genre')" class="flex gap-1 transition-all duration-200 cursor-pointer opacity-80 hover:opacity-100">
            <p class="inter-semibold text-md">GENRE</p>
            <i-lucide [img]="LucideChevronDown"></i-lucide>
          </div>
          <div *ngIf="isGenreDropDownOpen" class="absolute left-1/2 mt-2 dropdown-animate background-black text-white flex flex-col py-2 items-center justify-center w-35 rounded-md">
            <p (click)="selectGenre('Adventure')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Adventure</p>
            <p (click)="selectGenre('Action')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Action</p>
            <p (click)="selectGenre('Crime')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Crime</p>
            <p (click)="selectGenre('War')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">War</p>
            <p (click)="selectGenre('Romance')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Romance</p>
            <p (click)="selectGenre('Fiction')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Fiction</p>
            <p (click)="selectGenre('Science')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Science</p>
            <p (click)="selectGenre('Drama')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Drama</p>
            <p (click)="selectGenre('Comedy')" class="text-lg inter-semibold pl-5 text-left cursor-pointer opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Comedy</p>
          </div>
        </div>


        <div class="relative">
          <div (click)="toggleDropDown('sort')" class="flex gap-1 transition-all duration-200 cursor-pointer opacity-80 hover:opacity-100">
            <div class="flex gap-1 items-center justify-center">
              <p class="inter-regular text-sm">Sort By</p>
              <p class="inter-semibold text-md">WHEN ADDED</p>
            </div>
            <i-lucide [img]="LucideChevronDown"></i-lucide>
          </div>
          <div *ngIf="isSortDropDownOpen" class="absolute left-1/2 mt-2 dropdown-animate background-black text-white flex flex-col py-2 items-center justify-center w-50 rounded-md">
            <div class="flex flex-col gap-2 w-full">
              <p class="text-md inter-semibold px-5">When Added</p>
              <p (click)="selectSort('Added First')" class="text-md inter-medium px-5 text-right cursor-pointer py-1 opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Added First</p>
              <p (click)="selectSort('Added Last')" class="text-md inter-medium px-5 text-right cursor-pointer py-1 opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Added Last</p>
              <p  class="text-md inter-semibold px-5">Average Rating</p>
              <p (click)="selectSort('Highest First')" class="text-md inter-medium px-5 text-right cursor-pointer py-1 opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Highest First</p>
              <p (click)="selectSort('Lowest First')" class="text-md inter-medium px-5 text-right cursor-pointer py-1 opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Lowest First</p>
              <p class="text-md inter-semibold px-5">Average Rating</p>
              <p (click)="selectSort('Longest First')" class="text-md inter-medium px-5 text-right cursor-pointer py-1 opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Longest First</p>
              <p (click)="selectSort('Shortest First')" class="text-md inter-medium px-5 text-right cursor-pointer py-1 opacity-80 hover:opacity-100 button-greyforHover transition-all duration-200 w-full">Shortest First</p>
            </div>
          </div>
        </div>

      </div>
      <ng-container *ngIf="filteredMovies$ | async as movies">
        <ng-container *ngIf="movies.length > 0; else noMovies">
          <div class="grid grid-cols-8 gap-y-6 gap-x-6  w-full">
            <ng-container *ngFor="let movie of movies">
              <img
                routerLink="/movie" [queryParams]="{'id' : movie.movieDTO.id}"
                class="w-50 border-transparent border-3 rounded-md hover:border-white transition-all duration-200 cursor-pointer"   [src]="'https://image.tmdb.org/t/p/original/' + movie.details.poster_path">
            </ng-container>
          </div>
        </ng-container>
        <ng-template #noMovies>
          <p class="text-3xl inter-semibold">No movies found</p>
        </ng-template>
      </ng-container>
    </ng-container>
    <ng-template #noWatchedMovies>
      <p class="self-center text-3xl inter-semibold">No watched movies found , Browse our movies collection !</p>
    </ng-template>
  </ng-container>
  <ng-template #loadingOrError>
    <ng-container *ngIf="errorMessage ; else loading">
      <p class="text-red-500 text-lg inter-semibold">{{ errorMessage }}</p>
    </ng-container>
    <ng-template #loading>
      <span class="loading loading-spinner loading-lg self-center"></span>
    </ng-template>
  </ng-template>
</div>
